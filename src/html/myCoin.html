<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>我的万金币</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'Hiragino Sans GB', Helvetica, Arial, 'Lucida Grande', sans-serif;
            width: 3.2rem;
            margin: 0 auto;
            font-size: .12rem;
            background-color: #f6f4f4;
            -webkit-tap-highlight-color: transparent;
        }

        ol, ul {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #ffffff;
        }

        a {
            text-decoration: none;
            outline: none;
            color: rgb(25%, 25%, 25%);
            -webkit-tap-highlight-color: transparent;
        }

        .box-shadow {
            -webkit-box-shadow: 0 0 0.02rem #555;
            -moz-box-shadow: 0 0 0.02rem #555;
            box-shadow: 0 0 0.02rem #555;

        }

        a:hover {
            text-decoration: none;
        }

        div, h1, h2, h3, h4, h5, p {
            margin: 0;
            padding: 0;
        }

        .left {
            float: left;
        }

        .right {
            float: right;
        }

        li {
            font-size: 0.14rem;
        }

        li .every-line {
            padding: 0 0 0 0.12rem;
        }

        li .date {
            font-size: 0.1rem;
            margin-left: 1px;
        }

        li .height {
            height: 0.5rem;
        }

        li .money {
            line-height: 0.5rem;
            padding: 0 0.1rem 0 0;
        }

        .border-bottom {
            border-bottom: 1px solid #f1f1f1;
        }

        .hide {
            display: none;
        }

        .clear {
            clear: both;
        }

        .header {
            position: fixed;
            height: 1.95rem;
            background-color: #fff;
            z-index: 999;
        }

        .header .personal .icon {
            border-radius: 50%;
            width: .75rem;
            height: .75rem;
            margin-top: 0.2rem;
        }

        .header .nav {
            width: 100%;
            height: 0.45rem;
        }

        .nav .item {
            position: relative;
            text-align: center;
            float: left;
            height: 100%;
            width: 1.595rem;
            background-color: white;
            font-size: 0.11rem;
        }

        .nav .item .count {
            color: white;
            font-size: 0.14rem;
            height: 0.25rem;
            line-height: 0.15rem;
        }

        .nav .item .text {
            position: relative;
            color: rgb(25%, 25%, 25%);
            background-color: white;
            line-height: 0.45rem;
            height: 100%;
            font-size: 0.11rem;
            float: left;
            margin-left: 0.05rem;
        }

        .tab .divider {
            position: relative;
            float: left;
            background-color: white;
            height: 100%;
            opacity: 0.7;
            border-left: 1px solid #F39A0F;
            width: 1px;
        }

        .tab {
            height: 0.45rem;
            width: 3.2rem;
            color: rgb(25%, 25%, 25%);
            background-color: white;
        }

        .tab .child {
            height: 100%;
            line-height: 0.45rem;
            width: 49.7%;
            text-align: center;
        }

        .tab.check-left .left-child {
            /*border-right: 1px solid #F39A0F;*/
            border-bottom: 1px solid #F39A0F;
            color: #F39A0F;
        }

        .tab.check-right .right-child {
            /*border-left: 1px solid #F39A0F;*/
            border-bottom: 1px solid #F39A0F;
            color: #F39A0F;
        }

        .tab.check-left .right-child, .tab.check-right .left-child {
            border-bottom: 1px solid #f6f4f4;
        }

        .orange {
            color: #F39A0F;
        }

        .grey {
            color: rgb(192, 192, 192);
        }

        .black {
            color: rgb(25%, 25%, 25%);
        }

        .money {
            line-height: 0.5rem;
            padding: 0 0.1rem 0 0;
        }

        .count {
            position: relative;
            text-align: center;
            font-size: 0.36rem;
            /*width: 1.3rem;*/
            margin: 0 auto;
            padding-top: 0.22rem;
        }

        .no-border {
            border: 0;
        }

        .icon {
            float: left;
            margin-top: 0.125rem;
            margin-left: 0.34rem;
            width: 0.2rem;
            height: 0.2rem;
        }

        .list {
            position: absolute;
            width: 3.2rem;
            top: 1.95rem;
        }

        .load-more {
            text-align: center;
            font-size: 15px;
            height: 0.35rem;
        }

        .load-more .load_text {
            text-align: center;
            width: 100%;
            height: 100%;
            line-height: 0.35rem;
            color: #606060;
        }

        .load-more .loading {
            margin-top: 0.04rem;
            width: 0.2rem;
            height: 0.252rem;
        }

        .iframe {
            width: 3.2rem;
            top: 1.95rem;
            height: 100%;
            position: absolute;
            background-color: transparent;
        }

        @media (device-width: 320px ) and (device-height: 568px) and (-webkit-min-device-pixel-ratio: 2 ) {
            /* 兼容iphone5 */
            .border-bottom {
                border-bottom: 0.5px solid #d4d4d4;
            }

            .tab.check-left .left-child {
                border-bottom: 0.5px solid #F39A0F;
            }

            .tab.check-right .right-child {
                border-bottom: 0.5px solid #F39A0F;
            }

            .tab.check-left .right-child, .tab.check-right .left-child {
                border-bottom: 0.5px solid #f6f4f4;
            }

        }

        @media (device-width: 375px ) and (device-height: 667px) and (-webkit-min-device-pixel-ratio: 2 ) {
            /* 兼容iphone6 */
            .border-bottom {
                border-bottom: 0.5px solid #d4d4d4;
            }

            .tab.check-left .left-child {
                border-bottom: 0.5px solid #F39A0F;
            }

            .tab.check-right .right-child {
                border-bottom: 0.5px solid #F39A0F;
            }

            .tab.check-left .right-child, .tab.check-right .left-child {
                border-bottom: 0.5px solid #f6f4f4;
            }
        }

        @media (device-width: 414px ) and (device-height: 736px) and (-webkit-min-device-pixel-ratio: 2 ) {
            /* 兼容iphone6 Plus */
            .border-bottom {
                border-bottom: 0.5px solid #d4d4d4;
            }

            .tab.check-left .left-child {
                border-bottom: 0.5px solid #F39A0F;
            }

            .tab.check-right .right-child {
                border-bottom: 0.5px solid #F39A0F;
            }

            .tab.check-left .right-child, .tab.check-right .left-child {
                border-bottom: 0.5px solid #f6f4f4;
            }
        }


    </style>
</head>
<body class="hide">
<header class="header">
    <div style="background-color: #F39A0F;color: white;height: 0.95rem">
        <div style="float: left;color: white;padding:0.05rem 0.12rem;font-size: 0.1rem;opacity: 0.8">
            万金币余额
        </div>
        <div style="float: right; color: white;padding:0.05rem 0.12rem;font-size: 0.1rem;opacity: 0.8">
            折合金额：<span id="rmb"></span>元
        </div>
        <div class="count">
            <span id="coinCount">0.00</span><span style="font-size: 0.1rem">（个）</span>
        </div>
    </div>
    <div class="nav">
        <div class="item " onclick="toShop()">
            <div>
                <img src="../images/coin_shop.png" class="icon">
                <div class="text">万金币商城</div>
                <div class="clear"></div>
            </div>
        </div>
        <div class="item" style="border-left: solid 1px #f6f4f4" onclick="toRule()">
            <img src="../images/coin_rule.png" class="icon">
            <div class="text">万金币规则</div>
        </div>
    </div>
    <div style="width: 100%;height: 0.1rem;background-color: #f6f4f4"></div>

    <div class="tab check-left">
        <div class="child left left-child" id="nav-left" onclick="switchNav(this)">
            收支明细
        </div>
        <div class="child left right-child" id="nav-right" onclick="switchNav(this);">
            兑换明细
        </div>
    </div>
</header>
<div class="clear"></div>
<div class="list" id="income-list-div">
    <ul class="" id="incomeList">
        <!--<li>-->
        <!--<div class="every-line height border-bottom">-->
        <!--<div class="height left black">-->
        <!--<div style="margin-top:0.1rem;width:2.2rem;height:.2rem;overflow:hidden">-->
        <!--兑换礼品卡兑换礼品卡兑换礼...-->
        <!--</div>-->
        <!--<div class="date grey" style="margin-top: 0.02rem">-->
        <!--3月21日-->
        <!--</div>-->
        <!--</div>-->
        <!--<div class="height right orange money">-->
        <!--+100.00-->
        <!--</div>-->
        <!--</div>-->
        <!--</li>-->
    </ul>
    <div id="load-more_income" class="load-more hide" onclick="loadMore()">
        <div class="load_text" id="load_text_income">点击查看更多</div>
        <img src="../images/logo_loading.gif" id="load_img" class="loading hide">
    </div>
</div>
<iframe src="myCoinDetail.html" name="detailPage" id="exchange-list-iframe" frameborder="no" border="0" marginwidth="0"
        marginheight="0"
        scrolling="no"
        allowtransparency="yes" class="iframe hide">
</iframe>
<form id='infoForm' action='' method='post'></form>

</body>
<script src="../js/jquery-1.9.1.min.js"></script>
<script src="../js/jweixin-1.0.0.js"></script>
<script src="../js/common.js"></script>
<script src="../js/spinner.js"></script>
<!--<script src="../js/test-data.js"></script>-->
<script type="text/javascript">
    var isShowIncomeList = true;
    var isLoading = false;
    var page = 1;
    var pageSize = 20;
    var currentData2030 = '';
    var openId = window.localStorage.getItem(config.openIdName);
    $(function () {
        autoWidth();
        resizeHeight();
        baiduCollection();
    });
    switchNav($('#nav-left'));
    function resizeHeight() {
        var htmlFontSize = $('html').css('font-size').substr(0, $('html').css('font-size').length - 2);
        var liSize = $('#incomeList li').size() > $('#exchangeList li').size() ? $('#incomeList li').size() : $('#exchangeList li').size();
        var totalHeght = htmlFontSize * 1.95 + liSize * 0.5 * htmlFontSize;
        if (totalHeght > $(window).height()) {
            $('body').css('height', totalHeght);
            $('html').css('height', totalHeght);
            $('#exchange-list-iframe').css('height', totalHeght);
        } else {
            $('body').css('height', $(window).height());
            $('html').css('height', $(window).height());
            $('#exchange-list-iframe').css('height',  $(window).height());
        }
    }

    //加载收支明细
    GetAsyncData("User/2030", function (backdata) {
        currentData2030 = backdata;
        var count = '0.00';

        try {
            if (!isNaN(currentData2030.wjb))
                count = currentData2030.wjb + ".00";
        }
        catch (e) {
        }
        $('#coinCount').text(count);
        $('#rmb').text(count / 50.0);
        page = currentData2030.detail.nextPage;
        for (var i = 0; i < currentData2030.detail.data.length; i++) {
            var array = getYMD(currentData2030.detail.data[i].createDate.time.toString());
            var money = currentData2030.detail.data[i].amount.toString().indexOf('.') == -1 ? currentData2030.detail.data[i].amount + ".00" : currentData2030.detail.data[i].amount;
            if (currentData2030.detail.data[i].type == '50_080') {
            	 money = "-" + money;
            }else if(currentData2030.detail.data[i].type == '10_101'){
            	 money = "+" + money;
            }else if(currentData2030.detail.data[i].type == '10_102'){
            	 money = "-" + money;
            }else if(currentData2030.detail.data[i].type == '10_080'){
            	 money = "-" + money;
            } 
            else {
            	  money = "+" + money;
            }
            var description = currentData2030.detail.data[i].description;
            if(description.length>13){
                description = description.substr(0,13) + "...";
            }
            var htmlStr = "<li><div class='every-line height border-bottom'>" +
                    "<div class='height left black'>" +
                    "<div style='margin-top:0.11rem;width:2.2rem;height:.2rem;overflow:hidden'>" + description + "</div>" +
                    "<div class='date grey' style='margin-top: 0.02rem'>" + array[1] + "月" + array[2] + '日' + "</div></div>" +
                    "<div class='height right orange money'>" + money + "</div></div></li>";
            $('#incomeList').append(htmlStr);
        }
        if (currentData2030.detail.data.length == pageSize) {
            $('#load-more_income').removeClass('hide');
            $('#load_text_income').removeClass('hide');
            $('#load_img').addClass('hide');
        }
        resizeHeight();
    }, {"openId": openId, "page": page, "pageSize": pageSize});
    //加载兑换明细
    //    GetAsyncData("Wljw/1053", function (backdata) {
    //        var infoFormDetail = window.frames["detailPage"].document.getElementById('infoFormDetail');
    //        var form = $(infoFormDetail);
    //        $(form).attr('action', config.goldDetailUrl);//表单提交地址
    //        var htmlStr = "<input type='text' value='" + '' + "' name='pid'/>"
    //                + "<input type='text' value='" + '' + "' name='v'/>";
    //        form.append(htmlStr);
    //        form.submit();
    //    }, {"openId": openId});


    function getYMD(nS) {
        var time = new Date(parseInt(nS));
        var array = [];
        array[0] = time.getFullYear();
        array[1] = time.getMonth() + 1;
        array[2] = time.getDate();
        return array;
    }

    function switchNav(btn) {
        if ($(btn).attr('id') == 'nav-left') {
            $('.tab').addClass('check-left').removeClass('check-right');
            $('#exchange-list-iframe').addClass('hide');
            $('#income-list-div').removeClass('hide');
            isShowIncomeList = true;
        }
        else {
            $('.tab').addClass('check-right').removeClass('check-left');
            $('#income-list-div').addClass('hide');
            isShowIncomeList = false;
            //加载兑换明细
            GetAsyncData("Wljw/1053", function (backdata) {
            $('#exchange-list-iframe').removeClass('hide');
            var infoFormDetail = window.frames["detailPage"].document.getElementById('infoFormDetail');
            var form = $(infoFormDetail);
            $(form).attr('action', config.goldDetailUrl);//表单提交地址
            var htmlStr = "<input type='text' value='" + backdata.pid  + "' name='pid'/>"
                    + "<input type='text' value='" + backdata.v + "' name='v'/>";
            form.append(htmlStr);
            form.submit();

            var iframe = document.getElementById("exchange-list-iframe");
            iframe.onload = iframe.onreadystatechange = function () {
                if (!iframe.readyState || iframe.readyState == "complete") {
                    iframe.height = iframe.contentDocument.body.scrollHeight;
                }
            };

            }, {"openId": openId});
        }
    }

    function loadMore() {
        if (isLoading) {
            return;
        }
        if (isShowIncomeList && currentData2030.detail.data.length == pageSize) {
            isLoading = true;
            $('#load-more_income').removeClass('hide');
            $('#load_text_income').addClass('hide');
            $('#load_img').removeClass('hide');
            GetAsyncData("User/2030", function (backdata) {
                currentData2030 = backdata;
                page = currentData2030.detail.nextPage;
                for (var i = 0; i < currentData2030.detail.data.length; i++) {
                    var array = getYMD(currentData2030.detail.data[i].createDate.time.toString());
                    var money = currentData2030.detail.data[i].amount.toString().indexOf('.') == -1 ? currentData2030.detail.data[i].amount + ".00" : currentData2030.detail.data[i].amount;
                    if (currentData2030.detail.data[i].type != '50_080') {
                        money = "+" + money;
                    } else {
                        money = "-" + money;
                    }
                    var htmlStr = "<li><div class='every-line height border-bottom'>" +
                            "<div class='height left black'>" +
                            "<div style='margin-top:0.11rem;width:2.2rem;height:.2rem;overflow:hidden'>" + currentData2030.detail.data[i].description + "</div>" +
                            "<div class='date grey' style='margin-top: 0.02rem'>" + array[1] + "月" + array[2] + '日' + "</div></div>" +
                            "<div class='height right orange money'>" + money + "</div></div></li>";
                    $('#incomeList').append(htmlStr);
                }
                if (currentData2030.detail.data.length == pageSize) {
                    $('#load-more_income').removeClass('hide');
                    $('#load_text_income').removeClass('hide');
                    $('#load_img').addClass('hide');
                } else {
                    $('#load-more_income').addClass('hide');
                    $('#load_text_income').addClass('hide');
                    $('#load_img').addClass('hide');
                }
                isLoading = false;
                resizeHeight();
            }, {"openId": openId, "page": page, "pageSize": pageSize});
        } else {

        }
    }

    function toShop() {
//        showCenterSpinner();
        GetAsyncData("Wljw/1053", function (backdata) {
            var form = $('#infoForm');
            $(form).attr('action', config.goldStoreUrl);//表单提交地址
            var htmlStr = "<input type='text' value='" + backdata.pid + "' name='pid'/>"
                    + "<input type='text' value='" + backdata.v + "' name='v'/>";
            form.append(htmlStr);
            form.submit();
        }, {"openId": openId});
    }

    function toRule() {
        window.location.href = 'CoinRule.html';
    }
    window.onscroll = function () {
        if (scroll.getScrollTop() + scroll.getClientHeight() == scroll.getScrollHeight()) {
            loadMore();
        }
    }

</script>
</html>