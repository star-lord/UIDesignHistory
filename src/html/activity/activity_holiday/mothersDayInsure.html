<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>感恩母亲</title>
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none !important;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        body {
            font-family: 'Microsoft YaHei', 'Hiragino Sans GB', Helvetica, Arial, 'Lucida Grande', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f6f4f4;
            -webkit-tap-highlight-color: transparent;
        }

        ol, ul {
            list-style: none;
            padding: 0;
            margin: 0;
            border-bottom: 1px solid #d4d4d4;
            background-color: #ffffff;
        }

        a:hover {
            text-decoration: none;
        }

        a {
            text-decoration: none;
            outline: none;
            color: #515151;
            -webkit-tap-highlight-color: transparent;
        }

        .page1 {
            width: 100%;
            margin: 0 auto;
            color: #515151;
        }

        .col-20 {
            width: 19.9%;
            float: left;
        }

        .col-40 {
            width: 39.9%;
            float: left;
        }

        .col-60 {
            width: 59.9%;
            float: left;
        }

        input {
            border: 0 none;
            font-size: 0.12rem;
            outline: none;
        }

        input:focus {
            background: transparent;
        }

        input.disable {
            background-color: #fff;
            color: #aaa;
        }

        .tk {
            color: #016FEB;
        }

        .text {
            padding: 0 0.19rem;
            font-size: 0.08rem;
        }

        .enter_btn {
            height: 0.5rem;
            line-height: 0.5rem;
            background-color: rgb(251, 76, 15);
            color: #ffffff;
            text-align: center;
            font-size: 0.175rem;
            border-radius: 0.05rem;
            border-style: hidden;
            outline: none;
            margin: 0 0.19rem;
        }

        li {
            margin-left: 0.1rem;
            padding-left: 0.1rem;
            list-style-type: none;
            height: 0.45rem;
            line-height: 0.45rem;
            font-size: 0.12rem;
            border-bottom: 1px solid #d4d4d4;
            clear: both;
        }

        .banner {
            background: url("../../../images/activity/mothersDay/banner.jpg") no-repeat;
            background-size: 100% 100%;
            height: 1.1rem;
        }

        .get_code_btn {
            width: 0.8rem;
            text-align: center;
            color: #ffffff;
            border-radius: 0.03rem;
            font-size: 0.1rem;
            background-color: rgb(251, 76, 15);
            border-style: hidden;
            outline: none;
            margin-right: 15px;
            padding: 0.07rem;
        }

        .icon {
            width: 0.15rem;
            height: 0.15rem;
            float: right;
            margin-top: 0.14rem;
            background: url("../../../images/activity/mothersDay/right.png") no-repeat;
            background-size: contain;
        }

        .code {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            display: none;
        }

        .code img {
            width: 2.16rem;
            height: 2.37rem;
            z-index: 8;
        }

        .code .code-div {
            position: relative;
            margin-top: 30%;
            width: 2.16rem;
            height: 2.37rem;
            left: 50%;
            margin-left: -1.08rem;
        }

        .code .close {
            position: absolute;
            width: 0.35rem;
            height: 0.35rem;
            right: 0;
            top: 0;
            z-index: 9;
        }

        .no-border {
            border: 0 solid #d4d4d4;
        }

        .hide {
            display: none;
        }

        .disable {
            background-color: #ccc;
        }

        .clear {
            clear: both;
        }

        @media (device-width: 320px ) and (device-height: 568px) and (-webkit-min-device-pixel-ratio: 2 ) {
            /* 兼容iphone5 */
            ol, ul {
                border-bottom: 0.5px solid #d4d4d4;
            }

            li {
                border-bottom: 0.5px solid #d4d4d4;
            }

        }

        @media (device-width: 375px ) and (device-height: 667px) and (-webkit-min-device-pixel-ratio: 2 ) {
            /* 兼容iphone6 */
            ol, ul {
                border-bottom: 0.5px solid #d4d4d4;
            }

            li {
                border-bottom: 0.5px solid #d4d4d4;
            }

        }

        @media (device-width: 414px ) and (device-height: 736px) and (-webkit-min-device-pixel-ratio: 2 ) {
            /* 兼容iphone6 Plus */
            ol, ul {
                border-bottom: 0.5px solid #d4d4d4;
            }

            li {
                border-bottom: 0.5px solid #d4d4d4;
            }

        }

        @media screen and (min-width: 640px) {
            body {
                width: 3.2rem;
                margin: 0 auto;
            }
        }

    </style>

</head>
<body class="hide">
<div class="page1" style="overflow: hidden">
    <div class="banner">
        <a style=" -webkit-tap-highlight-color: transparent;webkit-touch-callout: none;-webkit-user-select: none;"
           href="mothersDayDetail.html">
            <div style="float: right; width: 40px;height: 40px;"></div>
        </a>
    </div>

    <ul>

        <li onclick="saveData()">
            <a href="mothersDayRule.html" style="width: 100%;height: 100%;display: block;">
                <div class="col-20">产品详情</div>
                <div class="col-40">
                    &nbsp;
                </div>
                <div class="col-40" style="margin-left: -5px;text-align: right;font-size: 0.09rem">
                    <i class="icon"></i>
                </div>

            </a>
        </li>

        <li>
            <div class="col-20">生效日期</div>
            <div class="col-40" id="date_div">
            </div>
            <div class="col-40"
                 style="margin-left: -15px;text-align: right;font-size: 0.09rem;">
                <div style="height: 0.45rem;line-height: 0.45rem">
                    次日凌晨生效
                </div>
            </div>
        </li>

        <li class="">
            <div class="col-20">姓名</div>
            <div class="col-60" id="name_div">

            </div>
        </li>
        <li>
            <div class="col-20">身份证</div>
            <div class="col-60" id="identifyNumber_div">

            </div>
        </li>
        <li>
            <div class="col-20">手机号</div>
            <div class="col-60" id="mobile_div">

            </div>
        </li>
        <li class="no-border">
            <div class="col-20">验证码</div>
            <div class="col-40" id="sendActiveCode_div">

            </div>
            <div class="col-40" style="text-align: right">
                <button id="get_code" class="get_code_btn disable" onclick="sendCode(this);return false;">获取验证码</button>
            </div>
        </li>

    </ul>

    <p class="text">我已认真阅读同意<a href="../activity_go_home/bxtk.html"><span class="tk" onclick="saveData()">《保险条款》</span></a>和
        <a href="../activity_go_home/gaozhi.html"><span class="tk" onclick="saveData()">《重要告知》</span></a>，了解并接受包括有关责任条款、承保地域限制等约定。
    </p>
    <div class="enter_btn" onclick="commit()">确认</div>
</div>

</body>
<script src="../../../js/common.js"></script>
<script src="../../../js/jquery-1.9.1.min.js"></script>
<script src="../../../js/tb-time.js" type="text/javascript"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="../../../js/spinner.js"></script>
<script type="text/javascript">

    var openId = window.localStorage.getItem(config.openIdName);
    var isShowLoadDialog = false;
    var uuid = "";
    var clock;
    var tomorrow = new Date();
    var isFocus = false;
    if (openId != null && openId.length != 0) {
        GetAsyncData("../../rest/User/1006", function (backData) {
            isFocus = backData.data.flag;
        }, {"openId": openId});
    }
    $(function () {
        var today = new Date();
        var tomorrow_milliseconds = today.getTime() + 1000 * 60 * 60 * 24 * 1;
        tomorrow.setTime(tomorrow_milliseconds); //注意，这行是关键代码

        var info_name = sessionStorage.getItem("info_name") == null ? "" : sessionStorage.getItem("info_name");
        var info_identifyNumber = sessionStorage.getItem("info_identifyNumber") == null ? "" : sessionStorage.getItem("info_identifyNumber");
        var info_mobile = sessionStorage.getItem("info_mobile") == null ? "" : sessionStorage.getItem("info_mobile");
        var info_sendActiveCode = sessionStorage.getItem("info_sendActiveCode") == null ? "" : sessionStorage.getItem("info_sendActiveCode");
        var info_insurance_start = sessionStorage.getItem("info_insurance_start") == null ? "" : sessionStorage.getItem("info_insurance_start");


        var dateStr = "<input type='text' value='" + tomorrow.format("yyyy-MM-dd") + "' class='disable' onfocus='$(this).blur()' id='insurance_start'>";
        var nameStr = "<input type='text' id='name' value='" + info_name + "' placeholder='请输入姓名'>";
        var identifyNumberStr = " <input type='text' value='" + info_identifyNumber + "' id='identifyNumber' maxlength='18' placeholder='请输入身份证号'>";
        var mobileStr = "<input type='number' value='" + info_mobile + "' maxlength='11' id='mobile' placeholder='请输入手机号' oninput='judge(this)'>";
        var sendActiveCodeStr = "<input type='number'  value='" + info_sendActiveCode + "' id='sendActiveCode' placeholder='请输入验证码'>";
        $("#date_div").append(dateStr);
        $("#name_div").append(nameStr);
        $("#identifyNumber_div").append(identifyNumberStr);
        $("#mobile_div").append(mobileStr);
        $("#sendActiveCode_div").append(sendActiveCodeStr);

        autoWidth();
        $('body').removeClass('hide');

        baiduCollection();
        closeActivity(config.activityEndTime.mothersDay);
    });

    weixinShare({
        shareUrl: config.shareRootUrl + '/weixinouter/basepage/pages/activity/activity_holiday/mothersDayPublicity.html',
        shareIcon: config.shareRootUrl + '/weixinouter/basepage/images/mothersDay/share_icon.jpg',
        shareText: '免费送你20万意外保障，五一带妈安心出游',
        isNeedRecord: true,
        openId: openId,
        activityId: '105',
        typeTimeline: 'zhbx-3',
        typeAppMessage: 'zhbx-4',
        isGiveCoin: 'Y'
    });

    function saveData() {
        sessionStorage.setItem("info_name", $("#name").val());
        sessionStorage.setItem("info_identifyNumber", $("#identifyNumber").val());
        sessionStorage.setItem("info_mobile", $("#mobile").val());
        sessionStorage.setItem("info_sendActiveCode", $("#sendActiveCode").val());
    }

    function sendCode(btn) {
        if (isShowLoadDialog) {
            return;
        }
        var mobile = $.trim($("#mobile").val());
        if (mobile == "" || mobile.length == 0) {
            alert("请输入手机号");
            return;
        }
        var nums = 60;
        btn.innerHTML = nums + ' 秒';
        $("#get_code").attr("disabled", true);
        $("#get_code").css("background-color", "#dddddd");
        clock = setInterval(function () {
            nums--;
            if (nums > 0) {
                btn.innerHTML = nums + ' 秒';

            } else {
                clearInterval(clock);
                btn.innerHTML = '获取验证码';
                $("#get_code").attr("disabled", false);
                $("#get_code").css("background-color", "rgb(251, 76, 15)");
                nums = 60;
            }
        }, 1000);

        GetAsyncData("../../rest/Transfer/1011", function (backdata) {
            var data = backdata.data;
            //alert("sendCode uuid:" + data.uuid);
            uuid = data.uuid;
            console.log(uuid);
        }, {"mobile": mobile});
    }

    function judge() {
        var mobile = $.trim($("#mobile").val());
        if (mobile.length > 11) {
            $("#mobile").val(mobile.substr(0, 11));
        }
        mobile = $.trim($("#mobile").val());
        if (!mobile.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/)) {
            $("#get_code").addClass("disable");
        } else {
            $("#get_code").removeClass("disable");
        }
    }

    function commit() {
        if (!isFocus) {
            showCodeDialog();
            return;
        }
        var name = $.trim($("#name").val());
        var number = $.trim($("#identifyNumber").val());
        var mobile = $.trim($("#mobile").val());
        var code = $.trim($("#sendActiveCode").val());
        if (name == "" || name.length == 0) {
            alert("请输入姓名");
            return;
        }
        if (number == "" || number.length == 0) {
            alert("请输入身份证号");
            return;
        } else if (!IdCardValidate(number)) {
            alert('身份证号不正确！');
            $("#identifyNumber").focus();
            return false;
        }
        else if (genderByIDCard(number) == 1 || ageByIDCard(number) < 20 || ageByIDCard(number) > 65) {
            alert("仅限20-65周岁的女性客户领取");
            return false;
        }

        if (mobile == "" || mobile.length == 0) {
            alert("请输入手机号");
            return;
        } else if (!$("#mobile").val().match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/)) {
            alert("手机号输入有误！");
            $("#mobile").focus();
            return false;
        }
        if (uuid == "" || uuid.length == 0) {
            alert("请获取验证码");
            return;
        }
        if (code == "" || code.length == 0) {
            alert("请输入验证码");
            return;
        }

        if ($.trim(code)) {
            showCenterSpinner();
            GetAsyncData("../../rest/Transfer/1012", function (backdata) {
                var data = backdata.data;
                if (data.resultCode != "0000") {
                    hideCenterSpinner();
                    alert("验证码不正确，请重新获取！");
                } else {
                    GetAsyncData("../../rest/Transfer/1013", function (backdata) {
                        console.log(JSON.stringify(backdata));
//                        alert(backdata.data.resultcode);
                        if (backdata.data.resultcode == "0001") {
                            alert(backdata.msg);
                            hideCenterSpinner();
                        } else if (backdata.code == 0 && backdata.data.resultcode == "0002") {

                            window.location.href = "mothersDaySuccess.html?first=0";
                            window.sessionStorage.setItem("mother_name", "");
                        } else if (backdata.code == 0 && backdata.data.resultcode == "0000") {
                            var data = backdata.data;
                            window.location.href = "mothersDaySuccess.html?first=1";
                            window.sessionStorage.setItem("mother_name", name);
                        } else {
                            alert('投保失败');
                            hideCenterSpinner();
                        }
                    }, {
                        "openid": "1050" + openId,
                        "productcode": "2014080001",
                        "combocode": "012016042601",
                        "cooperatecode": "000209",
                        "insuredname": name,
                        "identifynumber": number,
                        "insuranceStart": tomorrow.format("yyyy-MM-dd"),
                        "mobile": mobile
                    });
                }
            }, {"checkCode": code, "uuid": uuid});
        }
    }
</script>
</html>